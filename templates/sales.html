{% extends "base.html" %}
{% block content %}
<section class="card">
  <h2>Lançar venda manual</h2>
  <form class="form-grid" method="post" action="{{ url_for('nova_venda') }}">
    <label>Produto
      <select name="product_id" required>
        <option value="">Selecione</option>
        {% for p in products %}
        <option value="{{ p.id }}">{{ p.name }}</option>
        {% endfor %}
      </select>
    </label>
    <label>Data
      <input type="date" name="date">
    </label>
    <label>Quantidade
      <input type="number" step="0.01" name="quantity" required>
    </label>
    <label>Preço unitário (R$)
      <input type="number" step="0.01" name="unit_price" required>
    </label>
    <label>Comissão marketplace (R$)
      <input type="number" step="0.01" name="marketplace_fee">
    </label>
    <label>Outros custos (R$)
      <input type="number" step="0.01" name="other_variable_cost">
    </label>
    <label>Desconto (R$)
      <input type="number" step="0.01" name="discount">
    </label>
    <button class="btn-primary full-width">Salvar venda</button>
  </form>
</section>
<section class="card">
  <h3>Vendas registradas</h3>
  <p>
    <a class="btn-primary" href="{{ url_for('exportar_modelo_vendas') }}">Baixar modelo de vendas consolidadas</a>
    <a class="btn-primary" href="{{ url_for('importar_consolidado') }}">Importar vendas consolidadas</a>
  </p>
  <table>
    <thead>
      <tr>
        <th>Data</th><th>Produto</th><th>Qtd</th><th>Preço</th><th>Comissão</th><th>Outros</th><th>Desconto</th><th>Origem</th>
      </tr>
    </thead>
    <tbody>
      {% for s in sales %}
      <tr>
        <td>{{ s.date }}</td>
        <td>{{ s.product_name }}</td>
        <td>{{ s.quantity }}</td>
        <td>{{ '%.2f'|format(s.unit_price) }}</td>
        <td>{{ '%.2f'|format(s.marketplace_fee) }}</td>
        <td>{{ '%.2f'|format(s.other_variable_cost) }}</td>
        <td>{{ '%.2f'|format(s.discount) }}</td>
        <td>{{ s.source or '' }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</section>
{% endblock %}
